(function(){/*


 decibelsToLinear

 Copyright (C) 2010, Google Inc. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:
 1.  Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
 2.  Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 Hanning window taken from http://wiki.scipy.org/Cookbook/SignalSmooth
 both constant values and code preparing data for convolution
 Help from kr1 at http://stackoverflow.com/questions/14789283/what-does-the-fft-data-in-the-web-audio-api-correspond-to 
 Savitsky-Golay filter (VowelWorm.smoothCurve)
 adapted from http://wiki.scipy.org/Cookbook/SavitzkyGolay
 Psuedo-inverse function from http://www.numericjs.com/workshop.php?link=aacea378e9958c51af91f9eadd5bc7446e0c4616fc7161b384e5ca6d4ec036c7
 setStream helper functions borrow heavily from Chris Wilson's pitch
 detector, under the MIT license. See https://github.com/cwilso/pitchdetect
 MFCC code Derived from https://github.com/Maxwell79/mfccExtractor
 under Version 2 (1991) of the GNU General Public License
*/
window.d=window.d||{};
(function(h,m){function b(a){for(var c=0;c<a.length;c++)a[c]=Math.abs(a[c]);return a}function p(a,c){for(var g=0;g<a.length;g++)a[g]+=c;return a}function s(a){for(var c=[],g=a.length-1;-1<g;g--)c.push(a[g]);return c}var t=new window.ga,r=[],q={},k=[75,61];h.q={61:new Float32Array([0,0.00273905,0.0109262,0.02447174,0.04322727,0.0669873,0.0954915,0.12842759,0.1654347,0.20610737,0.25,0.29663168,0.3454915,0.39604415,0.44773577,0.5,0.55226423,0.60395585,0.6545085,0.70336832,0.75,0.79389263,0.8345653,0.87157241,
0.9045085,0.9330127,0.95677273,0.97552826,0.9890738,0.99726095,1,0.99726095,0.9890738,0.97552826,0.95677273,0.9330127,0.9045085,0.87157241,0.8345653,0.79389263,0.75,0.70336832,0.6545085,0.60395585,0.55226423,0.5,0.44773577,0.39604415,0.3454915,0.29663168,0.25,0.20610737,0.1654347,0.12842759,0.0954915,0.0669873,0.04322727,0.02447174,0.0109262,0.00273905,0]),75:new Float32Array([0,0.00180126,0.00719204,0.01613353,0.02856128,0.04438575,0.06349294,0.08574518,0.11098212,0.13902195,0.16966264,0.20268341,
0.23784636,0.27489813,0.31357176,0.35358861,0.39466037,0.43649109,0.4787794,0.5212206,0.56350891,0.60533963,0.64641139,0.68642824,0.72510187,0.76215364,0.79731659,0.83033736,0.86097805,0.88901788,0.91425482,0.93650706,0.95561425,0.97143872,0.98386647,0.99280796,0.99819874,1,0.99819874,0.99280796,0.98386647,0.97143872,0.95561425,0.93650706,0.91425482,0.88901788,0.86097805,0.83033736,0.79731659,0.76215364,0.72510187,0.68642824,0.64641139,0.60533963,0.56350891,0.5212206,0.4787794,0.43649109,0.39466037,
0.35358861,0.31357176,0.27489813,0.23784636,0.20268341,0.16966264,0.13902195,0.11098212,0.08574518,0.06349294,0.04438575,0.02856128,0.01613353,0.00719204,0.00180126,0])};h.j={t:function(a){0==a&&(a=1);return 26.81/(1+1960/a)-0.53}};h.N=function(a){return Math.pow(10,0.05*a)};h.normalize=function(a,c){if(!a.length)return[];if(void 0===c||null===c)c=h.j.t;if("function"!==typeof c)throw Error("Expecting a function as a method for VowelWorm.normalize");if(!(c.name in h.j))throw Error("Method '"+c.name+
"' is not part of VowelWorm.Normalization and cannot be used for normalization.");var g=null,f=null;switch(c){case this.j.t:g=c(a[2])-c(a[1]),f=c(a[2])-c(a[0])}return null===g||null===f?[]:[g,f]};h.U=function(a,c){if("undefined"===typeof h.q[c])throw Error("No precomputed Hanning Window values found for "+c);for(var g=[],f=c-1;0<f;f--)g.push(a[f]);for(f=0;f<a.length;f++)g.push(a[f]);for(f=a.length-1;f>a.length-c;f--)g.push(a[f]);for(var l=h.q[c],n=0,b=[],f=0;f<l.length;f++)n+=l[f];for(f=0;f<l.length;f++)b[f]=
l[f]/n;return h.v(b,g)};h.wa=function(a,c,g){c=Math.abs(parseInt(c));g=Math.abs(parseInt(g));var f=g+1;g=(c-1)/2;c=[];for(var l=-g;l<g+1;l++){for(var n=[],e=0;e<f;e++)n.push(Math.pow(l,e));c.push(n)}n=m.ya(c);e=n.D[0];f=n.ka;l=n.D;n=n.la;c=Math.max(c.length,c[0].length)*m.qa*e;for(var k=l.length,e=Array(k),k=k-1;-1!==k;k--)e[k]=l[k]>c?1/l[k]:0;c=m.O(m.O(n,m.pa(e)),m.Ba(f))[0];f=[];f=a.subarray?a.subarray(1,g+1):a.slice(1,g+1);f=s(f);f=p(f,-a[0]);f=b(f);l=a[0];for(n=0;n<f.length;n++)f[n]=-f[n]+l;l=
[];l=a.subarray?a.subarray(-g-1,-1):a.slice(-g-1,-1);l=s(l);l=p(l,-a[a.length-1]);l=b(l);g=l=p(l,a[a.length-1]);l=[];for(n=0;n<f.length;n++)l.push(f[n]);for(n=0;n<a.length;n++)l.push(a[n]);for(n=0;n<g.length;n++)l.push(g[n]);a=l;c=s(c);g=[];return g=h.v(c,a)};h.v=function(a,c){var g=[],f=null,l=null;a.length>c.length?(f=c,l=a):(f=a,l=c);for(var b=l.length-f.length+1,e=0;e<b;e++){for(var h=0,k=f.length,m=0;m<f.length;m++)h+=f[k-1-m]*l[m+e];g.push(h)}return g};h.m=1;h.p=2;h.o=3;h.n=4;h.h=function(a,
c,g){return c/2/(g/2)*a};h.K=function(a,c){for(var g=c[a],f=null,l=null,b=null,e=a-1;0<=e&&!(null!==b&&c[e]>b);e--)b=c[e],f=g-b;b=null;for(e=a+1;e<c.length&&!(null!==b&&c[e]>b);e++)b=c[e],l=g-b;g=null===f?+l:null===l?+f:f<l?f:l;return 0>g?0:g};h.g=function(a){var c=this;this.c=t;this.a=this.c.createAnalyser();this.f=null;this.a.fftSize=2048;this.s=new Float32Array(this.a.fftSize/2);this.r=null;a&&this.$(a);Object.keys(q).forEach(function(a){c[a]={};q[a].call(c[a],c)});r.push(this)};h.C=32;h.ja=5E3;
h.ia=5500;h.ha=8E3;h.g.prototype=Object.create(h);h.g.constructor=h.g;var e=h.g.prototype;h.Z=function(a){if(void 0!==e.draw||void 0!==q.draw)throw Error('Cannot define a VowelWorm module with the name "draw": a property with that name already exists. May I suggest "draw_kewl_sk8brdr_98" instead?');if("function"!==typeof a)throw Error("No callback function submitted.");q.draw=a;r.forEach(function(a){a.draw={};q.draw.call(a.draw,a)})};h.va=function(a){void 0!==q[a]&&(delete q[a],r.forEach(function(c){delete c[a]}))};
e.mode=null;e.$=function(a){if("string"===typeof a)this.I(a);else if("object"===typeof a&&"MediaStream"===a.constructor.name)this.H(a);else if(a&&"AUDIO"===a.tagName)this.G(a);else if(a&&"VIDEO"===a.tagName)this.J(a);else throw Error("VowelWorm.instance.setStream only accepts URL strings, instances of MediaStream (as from getUserMedia), or <audio> elements");};e.H=function(a){this.mode=this.o;this.c.na(a).connect(this.a)};e.F=function(a,c,g){for(var f=[],l,b,e,h=0;h<a.length;h++){var k=this.h(h,c,
g),m=f.length+1;switch(m){case 1:if(100>k)continue;break;case 2:if(600>k||150>k-f[0])continue;break;case 3:if(1500>k||500>k-f[1])continue;break;default:return}l=a[h-1]||0;b=a[h]||0;e=a[h+1]||0;if(b>l&&b>e&&0.1<=this.K(h,a)&&(f.push(k),3===m))break}return f};e.A=function(){switch(this.mode){case this.n:return this.f.buffer.sampleRate;case this.m:case this.p:return 44100;case this.o:return this.c.sampleRate;default:throw Error("Current mode has no method for sample rate");}};e.ra=function(){return this.a.fftSize};
e.T=function(a){var c=null;if(a.w)for(var c=[],g=0;g<a.w.length;g++)c[g]=Math.abs(a.w[g]);else{c=this.s;this.a.getFloatFrequencyData(c);for(var f=0;f<c.length;f++)c[f]=h.N(c[f])}var b=[],g=a.S,f=2*c.length,e=a.X,k=a.V,m=a.sampleRate||this.A();a=1125*Math.log(1+k/700);var k=1125*Math.log(1+e/700),p=(a-k)/(g+1),e=[];for(a=0;a<g+2;a++)e.push(Math.floor(700*f*(Math.exp((k+a*p)/1125)-1)/m));for(g=1;g<e.length-1;g++){var p=[],q=h.h(e[g-1],m,f),r=h.h(e[g],m,f),t=h.h(e[g+1],m,f);for(a=0;a<1+f/2;a++){var s=
h.h(a,m,f),k=null,k=s<=r&&s>=q?(s-q)/(r-q):s>r&&s<=t?(t-s)/(t-r):0;p.push(k)}b.push(p)}m=[];e=[];for(g=0;g<b.length;g++){for(f=a=k=0;f<b[g].length-1;f++)k+=b[g][f]*c[a++];m.push(Math.log(k))}for(g=0;g<b.length;g++){for(f=a=k=0;f<m.length;f++)k+=m[f]*Math.cos(g*(a++-0.5)*Math.PI/b.length);k/=b.length;e.push(k)}return e};e.sa=function(a,c){if(2!==arguments.length&&0!==arguments.length)throw Error("Invalid arguments. Function must be called either as  getFormants(data, sampleRate) or getFormants()");
var g=null;a?g=2*a.length:(a=this.s,g=this.a.fftSize,this.a.getFloatFrequencyData(a),c=this.A());for(var f=0;f<k.length;f++){var b=this.U(a,k[f]).slice(this.C),b=this.F(b,c,g);if(!(100>b[0]||1E3<b[0]||b[0]>=b[1]||600>b[1]||3E3<b[1]||b[1]>=b[2]||1500>b[2]||5E3<b[2]))return b}return[]};e.oa=function(){var a=r.indexOf(this);-1!==a&&r.splice(a,1);for(var c in this)this.hasOwnProperty(c)&&delete this[c]};e.I=function(a){function c(a){f.mode=this.n;f.r=a;f.L()}function b(){throw Error("Could not parse audio data. Make sure the file ("+
a+") you are passing to setStream or VowelWorm.instance is a valid audio file.");}var f=this,e=new XMLHttpRequest;e.open("GET",a,!0);e.responseType="arraybuffer";e.onerror=function(){throw Error("Tried to load audio file at '"+a+"', but a netowrk error occurred: "+e.statusText);};e.onload=function(){if(200!==e.status)throw Error("Tried to load audio file at '"+a+"', but the server returned "+e.status+" "+e.statusText+". Make sure the URL you are passing to setStream or VowelWorm.instance is correct");
f.c.decodeAudioData(this.response,c,b)};e.send()};e.G=function(a){console.warn("Cannot determine sample rate. Setting as 44100");this.mode=this.m;this.f=this.c.M(a);this.f.connect(this.a);this.a.connect(this.c.destination)};e.J=function(a){console.warn("Cannot determine sample rate. Setting as 44100");this.mode=this.p;this.f=this.c.M(a);this.f.connect(this.a);this.a.connect(this.c.destination)};e.L=function(){this.f=this.c.createBufferSource();this.f.buffer=this.r;this.f.connect(this.a)}})(window.d,
window.ua);
window.d.B=function(){function h(){s.forEach(function(k){k=k.u;for(var e=0;e<k.length;e++){var a=k[e];a.alpha-=0.2;0>=a.alpha&&(b.b.removeChild(a),k.splice(e,1),e--)}})}var m={element:u},b=this;b.width=m.width||700;b.height=m.height||500;b.ca=-1;b.da=2;b.ea=-1;b.fa=3;b.Y=300;b.W=8E3;b.R=10;b.aa=-70;var p=new Float32Array(1024),s=[],t=!0,r=new PIXI.DisplayObjectContainer;b.play=function(){b.P();window.requestAnimationFrame(b.play)};b.i=function(b){var e={};e.ba=b;e.u=[];s.push(e)};b.P=function(){var k=65280;
s.forEach(function(e){var a=e.u,c;e=e.ba;e.a.getFloatFrequencyData(p);b:{for(c=0;c<p.length;c++)if(p[c]>b.aa){c=!1;break b}c=!0}if(c)c=null;else{e=e.T({X:b.Y,V:b.W,S:b.R});if(e.length){c=b.ca;var g=b.ea;e={x:b.width/(b.da-c)*(e[2]-c),y:b.height-b.height/(b.fa-g)*(-e[1]-g)}}else e=null;c=e}null!==c&&(e=c.x,c=c.y,g=new PIXI.Sprite.fromImage("src/modules/core/circle.png"),g.position.x=e,g.position.y=c,g.za=k,a.push(g),b.b.addChild(g));a=k;if("number"==typeof a)for(a=a.toString(16);6>a.length;)a="0"+
a;a=tinycolor(a);a=a.xa(45).Aa();k=a=parseInt(a,16)});h();b.e.k(b.b)};Object.defineProperties(b,{ta:{enumerable:!0,get:function(){return t},set:function(k){k=!!k;t!==k&&((t=k)?b.b.addChild(r):b.b.removeChild(r),window.requestAnimationFrame(b.e.k))}}});b.b=new PIXI.Stage(void 0!==m.background?m.background:16777215);b.e=PIXI.autoDetectRenderer(b.width,b.height);try{m.element.appendChild(b.e.view)}catch(q){document.body.appendChild(b.e.view)}(function(){if(!r.children.length)for(var b=[["e",221.28871891963863,
252.35519027188354],["i",169.01833799969594,171.97765003235634],["a",317.6219414250667,337.00896411883406],["o",384.5714404194302,284.96641792056766],["u",412.17314090483404,231.94657762575406]],e=0;e<b.length;e++){var a=new PIXI.Text(b[e][0],{font:"35px sans-serif",fill:"black",align:"center"});a.position.x=b[e][1];a.position.y=b[e][2];r.addChild(a)}})();t&&b.b.addChild(r);m.l&&(m.l instanceof Array?m.l.forEach(function(k){b.i(k)}):b.i(m.l));b.e.k(b.b);b.play()};
window.d.Z(function(){this.minDecibels=-250;this.maxDecibels=-30;this.create=function(h,m,b){if(this.b)throw Error("Only one view per VowelWorm.instance allowed.");if(void 0===b||null===b)b=16777215;this.b=new PIXI.Stage(b);this.e=PIXI.autoDetectRenderer(h,m);this.e.k(this.b);return this.e.view}});var v=!1,w=document.getElementById("vid");w.loop=!0;var u=document.getElementById("graphs");document.getElementById("media_button").addEventListener("click",x);
document.getElementById("video_button").addEventListener("click",y);document.getElementById("mic_button").addEventListener("click",z);var A=new window.d.B;
function x(){function h(){s++;if(s==p.length)for(var b=0;b<p.length;b++)p[b].play()}function m(){t>=p.length&&(t=0);t++;if(t===p.length)for(var b=0;b<p.length;b++)p[b].play()}for(var b=[],p=document.getElementsByClassName("media"),s=0,t=0,r=0;r<p.length;r++){var q=p[r];q.style.display="block";q.load();q.addEventListener("canplaythrough",h);q.addEventListener("ended",m);q=new window.d.g(q);b.push(q);A.i(q)}}function y(){w.style.display="block";var h=new window.d.g(w);A.i(h)}
function z(){v||(B({ma:!0},C,D),v=!0)}function B(){(navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||function(){alert("getUserMedia missing")}).apply(navigator,arguments)}function C(h){h=new window.d.g(h);A.i(h)}function D(){alert("Could not capture microphone input")};}).call(this);
